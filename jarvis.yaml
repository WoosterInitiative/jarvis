- hosts: localhost
  tasks:

  - name: Create jarvisnet network
    docker_network:
      name: jarvisnet

### ---------------- MariaDB Home Assistant ------------------- ###
  - name: Setup MariaDB for Home Assistant
    docker_container:
      name: db_homeassistant
      image: linuxserver/mariadb
      pull: yes
      env:
        PUID: "1000"
        PGID: "1000"
        MYSQL_ROOT_PASSWORD: "PcwJ9Qd5DT"
        MYSQL_DATABASE: "homeassistant"
        MYSQL_USER: "homeassistant"
        MYSQL_PASSWORD: "homeassistant"
        TZ: "America/Los_Angeles"
        com.centurylinklabs.watchtower.enable: "true"
      networks:
        - name: jarvisnet
          aliases:
            - db_homeassistant
      volumes:
        - /opt/appdata/db_homeassistant:/config
      restart_policy: unless-stopped
      state: started

### ---------------- Home Assistant ------------------- ###
  - name: Setup Home Assistant
    docker_container:
      name: home-assistant
      image: homeassistant/home-assistant
      pull: yes
      volumes:
        - /opt/appdata/homeassistant:/config
      env:
        com.centurylinklabs.watchtower.enable: "true"
      labels:
        traefik.enable: "true"
        traefik.frontend.rule: "Host:home.wooster.xyz,home-assistant.wooster.xyz"
        traefik.port: "8123"
      networks:
        - name: jarvisnet
          aliases:
            - home-assistant
      restart_policy: unless-stopped
      state: started

### ---------------- MariaDB Nextcloud ------------------- ###
  - name: Setup MariaDB for Nextcloud
    docker_container:
      name: db_nextcloud2
      image: linuxserver/mariadb
      pull: yes
      env:
        PUID: "1000"
        PGID: "1000"
        MYSQL_ROOT_PASSWORD: "PcwJ9Qd5DT"
        MYSQL_DATABASE: "nextcloud"
        MYSQL_USER: "nextcloud"
        MYSQL_PASSWORD: "nextcloud"
        TZ: "America/Los_Angeles"
        com.centurylinklabs.watchtower.enable: "true"
      networks:
        - name: jarvisnet
          aliases:
            - db_nextcloud2
      volumes:
        - /opt/appdata/db_nextcloud2:/config
      restart_policy: unless-stopped
      state: started

### ---------------- Nextcloud ------------------- ###
  - name: Setup Nextcloud
    docker_container:
      name: nextcloud2
      image: linuxserver/nextcloud
      pull: yes
      volumes:
        - /opt/appdata/nextcloud2:/config
        - /mnt/fillmore/nextcloud2:/data
      env:
        com.centurylinklabs.watchtower.enable: "true"
      labels:
        traefik.enable: "true"
        traefik.protocol: "https"
        traefik.frontend.redirect.entryPoint: "https"
        traefik.frontend.rule: "Host:nextcloud2.wooster.xyz"
        traefik.port: "443"
      networks:
        - name: jarvisnet
          aliases:
            - nextcloud2
      restart_policy: unless-stopped
      state: started
